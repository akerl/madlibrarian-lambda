machine:
  services:
  - docker
  environment:
    PKGFORGE_STATEFILE: '/tmp/pkgforge'
dependencies:
  override:
  - 'rm -fr .git/modules && git submodule deinit -f . && git submodule update --init --recursive'
  - git submodule update --init
  - git fetch --tags origin
test:
  override:
  - make
  post:
  - cp -r pkg/* $CIRCLE_ARTIFACTS/
deployment:
  release:
    tag: /.*/
    commands:
    - make release
    - 'aws s3 cp $CIRCLE_ARTIFACTS/payload.zip "s3://akerl-madlibrarian/lambdas/payload-$CIRCLE_TAG.zip"'
